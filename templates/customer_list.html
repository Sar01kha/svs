{% extends "base.html" %}
{% block title %}Customers - SVS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="m-0">Customers</h2>
  <a class="btn btn-sm btn-success" href="{{ url_for('new_customer') }}">+ Add Customer</a>
</div>

<form method="get" action="{{ url_for('customer_list') }}" class="mb-3">
  <div class="input-group" style="max-width:480px;">
    <input type="text" name="q" class="form-control" placeholder="Search name, email, or phone"
           value="{{ q or '' }}">
    <button class="btn btn-primary" type="submit">Search</button>
    {% if q %}
      <a class="btn btn-outline-secondary" href="{{ url_for('customer_list') }}">Reset</a>
    {% endif %}
  </div>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Family name</th>
      <th>First name</th>
      <th>Contact</th>
      <th>Date joined</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for c in customers %}
    <tr>
      <td>{{ c.customer_id }}</td>
      <td>
        <a href="{{ url_for('customer_appointment', customer_id=c.customer_id) }}">
          {{ c.family_name }}
        </a>
      </td>
      <td>{{ c.first_name }}</td>
      <td>
        {% if c.email %}<div>{{ c.email }}</div>{% endif %}
        <div>{{ c.phone }}</div>
      </td>
      <!-- If you formatted date in SQL/route, use c.date_joined_fmt; otherwise keep c.date_joined -->
      <td>{{ c.date_joined_fmt if c.date_joined_fmt is defined else c.date_joined }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary"
           href="{{ url_for('customer_appointment', customer_id=c.customer_id) }}">
           View appointments
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
